local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local LocalPlayer = game:GetService("Players").LocalPlayer
local Mouse = LocalPlayer:GetMouse()
local HttpService = game:GetService("HttpService")

local OrionLib = {
    Elements = {},
    ThemeObjects = {},
    Connections = {},
    Flags = {},
    Themes = {
        Default = {
            Main = Color3.fromRGB(80, 25, 128),
            Second = Color3.fromRGB(100, 50, 150),
            Stroke = Color3.fromRGB(140, 100, 180),
            Divider = Color3.fromRGB(140, 100, 180),
            Text = Color3.fromRGB(240, 240, 240),
            TextDark = Color3.fromRGB(180, 180, 180)
        }
    },
    SelectedTheme = "Default",
    Folder = nil,
    SaveCfg = false
}

local Icons = {}

local Success, Response = pcall(function()
    Icons = HttpService:JSONDecode(game:HttpGetAsync("https://raw.githubusercontent.com/evoincorp/lucideblox/master/src/modules/util/icons.json")).icons
end)

if not Success then
    warn("\nOrion Library - Failed to load Feather Icons. Error code: " .. Response .. "\n")
end

local function GetIcon(IconName)
    if Icons[IconName] ~= nil then
        return Icons[IconName]
    else
        return nil
    end
end

local Orion = Instance.new("ScreenGui")
Orion.Name = "Orion"
Orion.BackgroundTransparency = 0.2
if syn then
    syn.protect_gui(Orion)
    Orion.Parent = game.CoreGui
else
    Orion.Parent = gethui() or game.CoreGui
end

if gethui then
    for _, Interface in ipairs(gethui():GetChildren()) do
        if Interface.Name == Orion.Name and Interface ~= Orion then
            Interface:Destroy()
        end
    end
else
    for _, Interface in ipairs(game.CoreGui:GetChildren()) do
        if Interface.Name == Orion.Name and Interface ~= Orion then
            Interface:Destroy()
        end
    end
end

function OrionLib:IsRunning()
    if gethui then
        return Orion.Parent == gethui()
    else
        return Orion.Parent == game.CoreGui
    end
end

local function MakeElement(Type, Name)
    local Element = Instance.new(Type)
    Element.BackgroundTransparency = 0.2
    Element.BackgroundColor3 = OrionLib.Themes[OrionLib.SelectedTheme].Main
    return Element
end

local function SetProps(Element, Props)
    for i, v in pairs(Props) do
        Element[i] = v
    end
    return Element
end

local function AddThemeObject(Element, ThemeKey)
    table.insert(OrionLib.ThemeObjects, {Element, ThemeKey})
    return Element
end

local function SetChildren(Parent, Children)
    for _, Child in ipairs(Children) do
        Child.Parent = Parent
    end
    return Parent
end

function OrionLib:MakeWindow(Config)
    local Window = {}
    local Container = Instance.new("Frame")
    Container.Name = Config.Name or "Window"
    Container.BackgroundTransparency = 0.2
    Container.BackgroundColor3 = OrionLib.Themes[OrionLib.SelectedTheme].Main
    Container.Size = UDim2.new(0, Config.Width or 500, 0, Config.Height or 600)
    Container.Position = UDim2.new(0.5, -(Config.Width or 500) / 2, 0.5, -(Config.Height or 600) / 2)
    Container.Parent = Orion
    
    local TabContainer = Instance.new("Frame")
    TabContainer.Name = "TabContainer"
    TabContainer.BackgroundTransparency = 0.2
    TabContainer.BackgroundColor3 = OrionLib.Themes[OrionLib.SelectedTheme].Second
    TabContainer.Size = UDim2.new(1, -10, 1, -40)
    TabContainer.Position = UDim2.new(0, 5, 0, 35)
    TabContainer.Parent = Container
    
    local TabList = Instance.new("Frame")
    TabList.Name = "TabList"
    TabList.BackgroundTransparency = 0.2
    TabList.BackgroundColor3 = OrionLib.Themes[OrionLib.SelectedTheme].Second
    TabList.Size = UDim2.new(1, 0, 0, 30)
    TabList.Position = UDim2.new(0, 0, 0, 5)
    TabList.Parent = Container
    
    local TabFunction = {}
    
    function TabFunction:AddTab(Config)
        local TabButton = Instance.new("TextButton")
        TabButton.Name = Config.Name or "Tab"
        TabButton.BackgroundTransparency = 0.2
        TabButton.BackgroundColor3 = OrionLib.Themes[OrionLib.SelectedTheme].Second
        TabButton.Text = Config.Name or "Tab"
        TabButton.TextColor3 = OrionLib.Themes[OrionLib.SelectedTheme].Text
        TabButton.Size = UDim2.new(0, 100, 1, 0)
        TabButton.Parent = TabList
        
        local Tab = Instance.new("ScrollingFrame")
        Tab.Name = Config.Name or "Tab"
        Tab.BackgroundTransparency = 0.2
        Tab.BackgroundColor3 = OrionLib.Themes[OrionLib.SelectedTheme].Main
        Tab.Size = UDim2.new(1, 0, 1, 0)
        Tab.Visible = false
        Tab.Parent = TabContainer
        
        local Container = Instance.new("Frame")
        Container.Name = "Container"
        Container.BackgroundTransparency = 0.2
        Container.BackgroundColor3 = OrionLib.Themes[OrionLib.SelectedTheme].Main
        Container.Size = UDim2.new(1, -10, 1, -10)
        Container.Position = UDim2.new(0, 5, 0, 5)
        Container.Parent = Tab
        
        local ElementFunction = {}
        
        function ElementFunction:AddLabel(Config)
            local Label = Instance.new("TextLabel")
            Label.Name = Config.Name or "Label"
            Label.BackgroundTransparency = 1
            Label.Text = Config.Text or "Label"
            Label.TextColor3 = OrionLib.Themes[OrionLib.SelectedTheme].Text
            Label.Size = UDim2.new(1, 0, 0, 20)
            Label.Parent = Container
        end
        
        return ElementFunction
    end
    
    return TabFunction
end

function OrionLib:Destroy()
    Orion:Destroy()
end

return OrionLib